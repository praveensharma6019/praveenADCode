@using Sitecore
@using Sitecore.Foundation.SitecoreExtensions.Extensions
@using Sitecore.Data.Fields
@using Sitecore.Data.Items
@using Sitecore.Foundation.Assets
@using Sitecore.Foundation.Assets.Models
@using Sitecore.Foundation.Assets.Services
@using Sitecore.ExperienceForms.Mvc.Html
@using Sitecore.Foundation.Dictionary.Extensions
@using Sitecore.Mvc
@using AdaniGreenTalks = Sitecore.AdaniGreenTalks.Website
@using System.Linq;
@model Sitecore.Mvc.Presentation.RenderingModel
@{
    var datasource = Sitecore.Mvc.Presentation.RenderingContext.Current.Rendering.DataSource;
    Item model = Sitecore.Context.Database.GetItem(datasource);
    string imgurl = "#";
    string altText = string.Empty;
    string linkurl = "#";
    string ReadMore = "";
    string strPathAndQuery = HttpContext.Current.Request.Url.Query;
    string requesturl = string.Empty;
    var storytemplatedid = AdaniGreenTalks.Templates.StoryTemplate.ID;

    var childlist = new List<Item>();
}

@if (model != null)
{

    childlist = model.GetChildren().Where(c => c.TemplateID == storytemplatedid).OrderBy(c => c.Fields["Date"].Value).ToList();

    <div class="goal-stories">
        <div class="container">
            <div class="heading">
                <h2>@Html.Sitecore().Field("ShortDescription", model)</h2>
                <p>@Html.Sitecore().Field("Summary", model)</p>
            </div>
            <div class="story-cards">

                @foreach (Item child in childlist)
                {
                    if (child.TemplateID == storytemplatedid)
                    {
                        Sitecore.Data.Fields.LinkField linkvalue = child.Fields["LinkUrl"];
                        if (linkvalue != null)
                        {
                            linkurl = linkvalue.GetFriendlyUrl();
                        }
                        Sitecore.Data.Fields.ImageField imgField = ((Sitecore.Data.Fields.ImageField)child.Fields["thumbnail"]);
                        if (imgField != null && imgField.MediaItem != null)
                        {
                            imgurl = Sitecore.Resources.Media.MediaManager.GetMediaUrl(imgField.MediaItem);
                            altText = imgField.Alt;
                        }
                        else
                        {
                            imgurl = "#";
                            altText = "";
                        }
                        <div class="single-card">
                            @if (linkvalue != null)
                            {
                                if (!string.IsNullOrEmpty(linkvalue.Text))
                                {
                                    ReadMore = linkvalue.Text;
                                }
                                else
                                {
                                    ReadMore = "Know More";
                                }
                                if (linkvalue.LinkType == "internal")
                                {
                                    <a href="@linkurl">
                                        <div class="card-img-container">
                                            <img src="@imgurl" alt="@altText">
                                        </div>
                                        <div class="desc">
                                            <h3>@Html.Sitecore().Field("Title", child)</h3>
                                            <p>@Html.Sitecore().Field("Summary", child)</p>
                                        </div>
                                        <span class="stories-know-more">
                                            @ReadMore
                                        </span>
                                    </a>
                                }
                                if (linkvalue.LinkType == "external")
                                {
                                    <a href="@linkurl" target="_blank" rel="noopener noreferrer">
                                        <div class="card-img-container">
                                            <img src="@imgurl" alt="@altText">
                                        </div>
                                        <div class="desc">
                                            <h3>@Html.Sitecore().Field("Title", child)</h3>
                                            <p>@Html.Sitecore().Field("Summary", child)</p>
                                        </div>
                                        <span class="stories-know-more">
                                            @ReadMore
                                        </span>
                                    </a>
                                }
                            }
                        </div>
                    }
                }
            </div>
        </div>
    </div>
}