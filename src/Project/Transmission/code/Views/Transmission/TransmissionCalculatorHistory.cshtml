@using Sitecore.Foundation.Dictionary.Extensions
@using Sitecore.Foundation.SitecoreExtensions.Extensions
@using Sitecore.Mvc.Configuration
@model Sitecore.Transmission.Website.Services.TransmissionRepository

@{
    var count = 1; var list = ViewBag.totalEstimated;
}
@if (Session["Message"] != null && !string.IsNullOrEmpty(Session["Message"].ToString()))
{
    Session["showPresentCarbonFootprint"] = "false";
    Response.Redirect("/Carbon-Footprint-Calculator");

}

else
{
    using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { id = "frmNewConnectionApplicationList", @class = "form-signin", enctype = "multipart/form-data" }))
    {
        Session["showPresentCarbonFootprint"] = "true";
        @Html.AddUniqueFormId()
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)
        <!-- Page Content -->
        <section class="section_calc">
            <div class="container">
                <div class="row mb-4">
                    <div class="col-lg-8">
                        <h1>Welcome, @Session["UserName"]</h1>
                        <h2>Your previous carbon calculations</h2>
                    </div>


                    <div class="col-lg-4">
                        <p class="btn-logout text-lg-right text-left mt-lg-0 mt-3">

                            <button id="logoutbtn" class="btn btn-primary">
                                <span class="fa fa-sign-out-alt mr-2" style="
"></span>Logout
                            </button>
                        </p>
                    </div>

                </div>

                @Html.Partial("_FYView", Model)

                <div class="table-responsive table-calc">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Sr. No</th>
                                <th>Consumption Month</th>
                                <th style="width: 151px;">Submit Date</th>
                                <th>Total Family members (F)</th>
                                <th>
                                    Total Domestic Uses (Tonnes) (A)
                                </th>
                                <th>Total Transportation Uses (Tonnes) (B)</th>
                                <th>Emission from Air Trips (Tonnes) (C)</th>
                                <th>Total Carbon Emission(Tonnes) (A+B+C)</th>
                                <th>Average Emission per Month per person (Tonnes) (A+B+C)/F </th>
                                <th>Committed Carbon Offset per Month per person</th>
                                <th style="width:100px">View | Edit</th>
                            </tr>
                        </thead>
                        <tbody>


                            @foreach (var app in Model.FinalHistoryLists)
                            {
                                <tr>
                                    <td>@count</td>
                                    <td>@(app.MonthName + " " + app.Year)</td>
                                    <td>@Convert.ToDateTime(app.FormSubmitOn).ToString("dd-MM-yyyy")</td>
                                    <td>@app.TotalFamilyMembers</td>
                                    @*<td>@app.EmissionfromDomesticUse</td>*@
                                    <td>@Math.Round(Convert.ToDecimal(app.EmissionfromDomesticUse), 2)</td>
                                    @*<td>@app.EmissionfromTransportation</td>*@
                                    <td>@Math.Round(Convert.ToDecimal(app.EmissionfromTransportation), 2)</td>
                                    @*<td>@app.NumberofTrips</td>*@
                                    <td>@Math.Round(Convert.ToDecimal(app.NumberofTrips), 2)</td>
                                    <td>@Math.Round((Convert.ToDecimal(app.EmissionfromDomesticUse) + Convert.ToDecimal(app.EmissionfromTransportation) + Convert.ToDecimal(app.NumberofTrips)), 2)</td>

                                    @*<td>@app.AverageEmissionperMonth</td>*@
                                    <td>@Math.Round(Convert.ToDecimal(app.AverageEmissionperMonth), 2)</td>
                                    <td>@app.AverageOffsetEmissionperMonth</td>
                                    <td><a href="/Carbon-Footprint-Calculator?RegistrationNo=@app.RegistartionNumber" target="_blank">View | Edit</a></td>



                                </tr>
                                count = count + 1;
                            }

                        </tbody>
                    </table>
                </div>

                <div class="text-right">
                    <a href="/Carbon-Footprint-Calculator" class="btn btn-primary">@*Calculate*@ New Entry</a>
                </div>
            </div>
        </section>

        if (Session["ReviewMessage"] != null && !string.IsNullOrEmpty(Session["ReviewMessage"].ToString()))
        {
            <div class="form-group row">
                <input id="ReviewMessage" type="hidden" value="@Session["ReviewMessage"].ToString()" />
            </div>

            <div id="message_modal" class="modal fade show" role="dialog" style="display: none; padding-right: 17px;" data-id="">
                <div class="modal-dialog modal-dialog-centered">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <p>Message</p>
                            <button type="button" class="close" data-dismiss="modal">X</button>
                        </div>
                        <div class="modal-body">
                            @if (Session["ReviewMessage"] != null && !string.IsNullOrEmpty(Session["ReviewMessage"].ToString()))
                            {
                                <div class="form-group row">
                                    <label for="" class="col-sm-12 col-form-label txt-green">@Session["ReviewMessage"].ToString()</label>
                                </div>
                                Session["ReviewMessage"] = null;
                                Session["AlertMessage"] = null;
                            }
                        </div>
                        <button type="button" style="padding-bottom:10px;" class="close" data-dismiss="modal">Ok</button>
                    </div>

                </div>
            </div>
        }

    }

}