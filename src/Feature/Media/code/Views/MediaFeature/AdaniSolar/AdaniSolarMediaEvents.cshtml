@using Sitecore.Data.Fields
@using Sitecore.Feature.Media
@using Sitecore.Feature.Media.Repositories
@using Sitecore.Foundation.Alerts
@using Sitecore.Foundation.Alerts.Extensions
@using Sitecore.Foundation.Dictionary.Extensions
@using Sitecore.Foundation.SitecoreExtensions.Extensions
@using Sitecore.Foundation.Theming.Extensions
@using Sitecore.Resources.Media
@model Sitecore.Mvc.Presentation.RenderingModel

@{
    var datasource = Sitecore.Mvc.Presentation.RenderingContext.Current.Rendering.DataSource;
    var elements = Sitecore.Context.Database.GetItem(datasource);
    int i = 1;
    int j = 1;
}
@if (elements != null)
{
    var itemList = elements.GetChildren().ToList().Where(x=>x.TemplateID==Templates.SolarPageTypeNews.ID);

    <h3 class="section-heading">@Html.Sitecore().Field(Templates.HasPageContent.Fields.Title, elements)</h3>
    <div class="owl-carousel events-tile">
        @if (itemList != null)
        {
            foreach (var item in itemList)
            {
                Sitecore.Data.Fields.LinkField linkvalue = item.Fields["LinkUrl"];
                var linkUrl = linkvalue.GetFriendlyUrl();
                <div class="item" data-toggle="modal" data-target="#modalevent-@i">
                    @Html.Sitecore().ImageFieldWithoutSize2(Templates.SolarPageTypeNews.Fields.Image, item, cssClass: "img-fluid")
                    <p class="events-title">@Html.Sitecore().Field(Templates.SolarPageTypeNews.Fields.Title, item)</p>
                    <p class="events-desc">
                        <span>
                            @Html.Sitecore().Field(Templates.SolarPageTypeNews.Fields.Summary, item)
                        </span>
                    </p>
                </div>

                i++;
            }
        }
    </div>
    <p class="text-right"><a href="@elements.Url()">View all</a></p>
    <section>
        @if (itemList != null)
        {
            foreach (var item in itemList)
            {
                var innerItem = item.Axes.GetDescendants().Where(x => x.TemplateID == new Sitecore.Data.ID("{F0369E1A-9030-4A05-A09C-EF09B664ED27}"));
                if (innerItem != null && innerItem.Count() > 0)
                {
                    <div class="modal events-modal" id="modalevent-@j">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <div class="modal-body">
                                    <div class="owl-carousel events-item">
                                        @foreach (var inner in innerItem)
                                        {
                                            if (inner != null)
                                            {
                                                <div class="item">
                                                    @Html.Sitecore().ImageFieldWithoutSize2(Templates.HasMediaImage.Fields.Image, inner, cssClass: "img-fluid")
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                }
                j++;
            }
        }
    </section>
}